<!DOCTYPE html>
<html>
  <head>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      .background {
        background: url("Img/Screenshot_2025-03-24_114434 (1).jpg") no-repeat center center fixed;
        background-size: cover;
        min-height: 100%;
        padding: 20px;
      }
      .display {
        margin-top: 20px;
      }
      
      .displaya {
        position: relative;
        left: 10px;
        border-radius: 5px;
        width: 300px;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }
      
      .add {
        position: relative;
        left: 20px;
        top: 20px; 
        padding: 5px 15px;
        border: none;
        border-radius: 3px;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
      }
      
      .add:hover {
        background-color: #45a049;
      }
      
      .message {
        position: relative;
        left: 70px;
        top: 20px;
        color: #333;
        font-weight: bold;
      }
      
      .review {
        position: relative;
        left: 100px;
        top: 20px;
        color: blue;
        text-decoration: none;
      }
      
      .day, .job, .amount {
        position: relative;
        left: 50px;
        margin: 5px 0;
        padding: 5px;
        width: 200px;
        border: 1px solid #ddd;
        border-radius: 3px;
      }
      
      .job {
        top: 20px;
      }
      
      .amount {
        top: 40px;
      }
      
      .breakdown {
        position: relative;
        top: 50px;
        right: 60px;
        border: 1px solid #ccc;
      }
       
      input:disabled {
        background-color: #f0f0f0;
        color: #333;
        border: 1px solid #ddd;
      }
      
      .week-display {
        font-size: 1.2em;
        margin-bottom: 10px;
      }
      
      .error-message {
        color: red;
        position: relative;
        top: 20px;
        left: 50px;
      }
    </style>
  </head>
  <body>
    <div class="background">
      <h3>Rollover: <span id="clientCount">0</span></h3>
      <h3>Income Record</h3>
      <h3>Users: <span id="userCount">0</span></h3>
      
      <button onclick="beginSession()">Begin Session</button>
      <div class="display" id="display"></div>
    </div>
    
    <script>
      // Main data structure
      let appData = {
        userCount: 0,
        sessions: {},
        currentSession: null,
        currentWeek: 1,
        currentDay: null,
        isEditing: false
      };
      
      // Load data from localStorage
      function loadData() {
        const savedData = localStorage.getItem("appData");
        if (savedData) {
          appData = JSON.parse(savedData);
          if (!appData.currentWeek) appData.currentWeek = 1;
          updateUI();
        }
      }
      
      // Save data to localStorage
      function saveData() {
        localStorage.setItem("appData", JSON.stringify(appData));
      }
      
      // Update UI elements
      function updateUI() {
        document.getElementById("userCount").textContent = appData.userCount;
      }
      
      // Initialize
      document.addEventListener('DOMContentLoaded', function() {
        loadData();
      });
      
      function beginSession() {
        const sessionId = "session_" + Date.now();
        appData.currentSession = sessionId;
        appData.sessions[sessionId] = {
          createdAt: new Date().toISOString(),
          weekData: {},
          weekNumber: appData.currentWeek
        };
        
        saveData();
        renderSessionUI();
      }
      
      function renderSessionUI() {
        const display = document.getElementById("display");
        display.innerHTML = '';
        
        const displaya = document.createElement("div");
        displaya.className = "displaya";
        displaya.style.height = "350px";
        display.appendChild(displaya);
        
        const addBtn = document.createElement("button");
        addBtn.className = "add";
        addBtn.id = "addBtn";
        addBtn.innerText = appData.isEditing ? "Save" : "Add";
        addBtn.onclick = handleAddDay;
        displaya.appendChild(addBtn);
        
        const message = document.createElement("span");
        message.className = "message";
        message.id = "message";
        message.textContent = appData.isEditing ? 
          "Editing..." : 
          "Last update: Week " + appData.currentWeek + (appData.currentDay ? ", " + appData.currentDay : "");
        displaya.appendChild(message);
        
        const review = document.createElement("a");
        review.className = "review";
        review.href = "review.html";
        review.textContent = "Review";
        displaya.appendChild(review);
        
        const dayInput = document.createElement("input");
        dayInput.className = "day";
        dayInput.id = "day";
        dayInput.placeholder = "Day (e.g., Monday)";
        dayInput.disabled = !appData.isEditing;
        displaya.appendChild(dayInput);
        
        const breakdownImg = document.createElement("img");
        breakdownImg.className = "breakdown";
        breakdownImg.src = "Img/1000006714.png";
        breakdownImg.style.height = "40px";
        breakdownImg.style.width = "60px";
        displaya.appendChild(breakdownImg);
        
        const jobInput = document.createElement("input");
        jobInput.className = "job";
        jobInput.id = "job";
        jobInput.placeholder = "Job description";
        jobInput.disabled = !appData.isEditing;
        displaya.appendChild(jobInput);
        
        const amountInput = document.createElement("input");
        amountInput.className = "amount";
        amountInput.id = "amount";
        amountInput.placeholder = "Amount ($)";
        amountInput.disabled = !appData.isEditing;
        displaya.appendChild(amountInput);
        
        // Clear any existing error message
        const existingError = document.getElementById("errorMessage");
        if (existingError) {
          existingError.remove();
        }
      }
      
      function handleAddDay() {
        if (!appData.isEditing) {
          // First click - enable editing mode
          appData.isEditing = true;
          renderSessionUI();
          document.getElementById("day").focus();
          return;
        }
        
        // Save the data
        const dayValue = document.getElementById("day").value;
        const jobValue = document.getElementById("job").value;
        const amountValue = document.getElementById("amount").value;
        
        if (!dayValue || !jobValue || !amountValue) {
          // Remove any existing error message first
          const existingError = document.getElementById("errorMessage");
          if (existingError) {
            existingError.remove();
          }
          
          // Create new error message
          const errorMessage = document.createElement("div");
          errorMessage.className = "error-message";
          errorMessage.id = "errorMessage";
          errorMessage.textContent = "Please fill all fields!";
          document.getElementById("displaya").appendChild(errorMessage);
          return;
        }
        
        // Save to appData
        appData.currentDay = dayValue;
        const dayCount = Object.keys(appData.sessions[appData.currentSession].weekData).length + 1;
        appData.sessions[appData.currentSession].weekData["day" + dayCount] = {
          date: dayValue,
          job: jobValue,
          amount: amountValue
        };
        
        // Clear inputs and disable editing
        appData.isEditing = false;
        
        saveData();
        renderSessionUI();
      }
    </script>
  </body>
</html>